name: Sync from Public Repo (gl-copy-site)

on:
  repository_dispatch:
    types: [sync_public_to_private]  # triggered by public repo
  workflow_dispatch:   # allows manual trigger

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout the private repo branch
      - name: Check out private repo
        uses: actions/checkout@v4
        with:
          ref: current  # Your private branch to update

      # 2️⃣ Add public repo as remote (read-only)
      - name: Add public repo as remote
        run: |
          git remote add public https://github.com/smarvin/gl-copy-site.git
          git fetch public mirror

      # 3️⃣ Merge public/mirror → current
      - name: Merge public/mirror into current
        run: |
          git merge public/mirror --allow-unrelated-histories -m "Merge public mirror into current" || echo "No changes to merge."

      # 4️⃣ Push updates to private repo
      - name: Push to private repo
        run: |
          git push origin current

      # 5️⃣ Log recent commits for visibility
      - name: Show latest commits
        run: |
          git log -5 --oneline
          git remote -v
